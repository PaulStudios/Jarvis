<!DOCTYPE html>
<html>
  <title>
    JarvisAI | PaulStudios
  </title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="..\Javascripts\Title.js"></script>
  <script src="..\Javascripts/cookie.js"></script>
  <script src="..\Javascripts/Welcome.js"></script>
  <link rel="stylesheet" href="..\css\main.css">
  <script> 
    document.onreadystatechange = function() { 
        if (document.readyState !== "complete") { 
            document.querySelector( 
              "body").style.visibility = "hidden"; 
            document.querySelector( 
              "#loader").style.visibility = "visible"; 
        } else { 
            document.querySelector( 
              "#loader").style.display = "none"; 
            document.querySelector( 
              "body").style.visibility = "visible"; 
        } 
    }; 
</script> 
  <body>
    <div id="loader" class="center"></div>
    <marquee behavior="Alternate" direction="Right" ScrollAmount="10">
      <a href="http://paulstudios.great-site.net" ><img src="https://i.imgur.com/qOie39M.jpg" alt="Pauls" style="border:3.5px solid Green;" width="60" height="60"></a>
    </marquee>
    <h3 class="Heading" style="font-size: 250%;"id="tempheading">
      Welcome to JarvisAI
      </h3>
      <h3 class="mainHeading" style="font-size: 250%;" id="heading">
      </h3>
    <p id="Hi1">...</p>
    <p id="Hi2">...</p>
    <p id="Hi3">...</p>
    <p id="Hi4">...</p>
    <p id="Hi5">...</p>
    <p id="Hi6">...</p>
    <p id="Hi7">...</p>
    <p id="Hi8">...</p>
    <p id="Hi9">...</p>
    <p id="Hi10">...</p>
    <hr>
    <label for="input">Input: </label>
    <input type="text" id="input" name="input" maxlength="100">&nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" value="Submit" id="submit">
    
    <p id="debug"></p>
    <script>
      var hi1 = document.getElementById("Hi1");
      var hi2 = document.getElementById("Hi2");
      var hi3 = document.getElementById("Hi3");
      var hi4 = document.getElementById("Hi4");
      var hi5 = document.getElementById("Hi5");
      var hi6 = document.getElementById("Hi6");
      var hi7 = document.getElementById("Hi7");
      var hi8 = document.getElementById("Hi8");
      var hi9 = document.getElementById("Hi9");
      var hi10 = document.getElementById("Hi10");
      var input = document.getElementById("input");
      var debug = document.getElementById("debug");
      debug.style.color = "Red";
      var starting = 1, started = 0, user = "", pass = "", email = "", login = 0, register = 0, startinput = 0;
      var api = "none", api2 = "", processing = 0;
      const Http = new XMLHttpRequest();
      const loginfunc = function(username = "", password = "") {
        console.log("Logging in...");
        console.log("Username: " + username);
        console.log("Password: " + password);
        processing = 1
        $req = $.get(api2 + "/login?user=" + username + "&pass=" + password, function(data, status){
                console.log("API Request Status: " + status);
                if (data == "Success") {
                  hi9.innerHTML = "Logged In!"
                  started = 1
                  processing = 0
                } else if (data == "not found user") {
                  hi9.innerHTML = "Wrong Username. Pls reload page"
                  processing = 0
                } else if (data == "wrong pass") {
                  hi9.innerHTML = "Wrong Password. Pls reload page"
                  processing = 0
                } else {
                  hi9.innerHTML(data)
                  processing = 0
                }
              });
      }

      const regfunc = function(name, word, mail) {
        console.log("Registering")
        console.log("Username: " + name);
        console.log("Password: " + word);
        console.log("Email: " + mail);
        processing = 1
        api2 = "https://PaulStudiosAPI.hilfing.repl.co"; 
        rdata = "?user=" + name + "&pass=" + word + "&email=" + mail
        urlreq = api2 + "/register" + rdata
        $res = $.get(urlreq, function(data2, status){
          console.log("API Request Status: " + status);
          if (data2 == "Success") {
            res1 = "Successfully registered and Logged in"
            hi10.innerHTML = res1
          }
          processing = 0
          started = 1
        })
      }

      const scrolltext = function() {
        hi1.innerHTML = hi2.innerHTML;
        hi2.innerHTML = hi3.innerHTML;
        hi3.innerHTML = hi4.innerHTML;
        hi4.innerHTML = hi5.innerHTML;
        hi5.innerHTML = hi6.innerHTML;
        hi6.innerHTML = hi7.innerHTML;
        hi7.innerHTML = hi8.innerHTML;
        hi8.innerHTML = hi9.innerHTML;
        hi9.innerHTML = hi10.innerHTML;
        hi10.innerHTML = "...";
      }

      const talk = function(input, _callback) {
        add = "uid=" + user + "&msg=" + input
        processing = 1
        $response = $.get(api2 + "/talk?" + add,
                    function(data, status){
                      console.log("Bot Connection Status: " + status);
                      _callback(data)
                      processing = 0
                      return data;
                    });
      }

      function namechange(firstName) {
    if (firstName !== "") {
        document.getElementById("heading").innerHTML="Hello " + firstName + ", Welcome to JarvisAI";
	    document.getElementById("tempheading").style.display = "none";
        document.getElementById("heading").style.display = "block";
    } else {
        console.log("Invalid Name Argument passed")
    }
}

      window.onload = function() {
        loadname()
        document.getElementById("tempheading").style.display = "none";
        api = "https://paulstudiosapi.herokuapp.com";
        api2 = "https://PaulStudiosAPI.hilfing.repl.co";       
        Http.open("GET", api);
        Http.send();
        Http.onreadystatechange = (e) => {
          r = Http.responseText;
          console.log(r);
        }
        hi1.innerHTML = "Type start to start the process";
      }
      document.getElementById("submit").onclick = function() {
        debug.innerHTML = ""
        if (input.value == "") {
          debug.innerHTML = "No input submitted";
          return;
        }
        if (processing === 1) {
          debug.innerHTML = "Wait for Bot to reply";
          return
        }
        console.log("Proccessing Input...")
        if (started === 0) {
          if (starting === 1) {
            if (login === 0 && register === 0) {
              if (startinput === 0) {
                if (input.value === "start") {
                  hi2.innerHTML = "Starting JarvisAI...";
                  console.log("Initializing user login/register procedure...");
                  hi3.innerHTML = "You must Login to use JarvisAI";
                  hi4.innerHTML = "Type 1 to Login";
                  hi5.innerHTML = "Type 2 to Register";
                  startinput = 1;
                } else {
                  debug.innerHTML = "Invalid Command Specified"
                }
              } else if (startinput === 1) {
                if (input.value === "1") {
                  login = 1;
                  hi6.innerHTML = "Pls enter your username";
                  starting = 2
                } else if (input.value === "2") {
                  register = 1;
                  hi6.innerHTML = "Pls enter your new username";
                  starting = 2;
                }
               }
            }
          } else if (starting === 2) {
            if (login === 1) {
              user = input.value;
              hi7.innerHTML = "Pls enter your password";
              starting = 3;
            } else if (register === 1) {
              user = input.value;
              hi7.innerHTML = "Pls enter your new password";
              starting = 3;
            }
          } else if (starting === 3) {
            if (login === 1) {
              pass = input.value;
              hi8.innerHTML = "Logging in...";
              loginfunc(user, pass);
            } else if (register === 1) {
              pass = input.value;
              hi8.innerHTML = "Pls enter your new email";
              starting = 4;
            }
          } else if (starting === 4) {
            email = input.value
            hi9.innerHTML = "Registering"
            regfunc(user, pass, email)
          }
        } else {
          if (hi10 !== "...") {
            scrolltext();
          }
          hi10.innerHTML = user + ": " + input.value;
          talk(input.value, function(ponse){
            scrolltext();
            hi10.innerHTML = "JarvisAI: " + ponse
          });
          ;
        }
      }
    </script>
  </body>
</html>
